rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- Helper Functions ---

    // Check if the request body contains valid repository fields
    function isValidRepository() {
      let data = request.resource.data;
      return data.name is string 
          && data.name.size() > 0
          && data.description is string
          && data.ownerId is string
          && data.ownerName is string
          && data.isPublic is bool
          && data.games is list
          && data.createdAt is number;
    }

    // --- Rules ---
    //
    // SECURITY MODE:
    // All client direct access is denied. The app must use server-side APIs
    // (Next.js route handlers + Firebase Admin) for all Firestore reads/writes.
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
